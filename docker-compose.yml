services:
  jimeng-api:
    # 使用 GHCR 上的镜像（生产环境）
    image: ghcr.io/iptag/jimeng-api:latest
    container_name: jimeng-api
    # 本地开发时可以取消注释下面的 build 配置
    # image: jimeng-api:latest
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "5100:5100"
    #volumes:
    #  # 挂载日志目录（确保权限正确）
    #  - ./logs:/app/logs
    #  # 挂载临时目录
    #  - ./tmp:/app/tmp
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:5100/ping"]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 20s
    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  jimeng-web-ui:
    # Web UI（前端静态站点）
    # 访问地址：http://localhost:9901
    # 默认 API 地址：http://localhost:5100（可在页面「设置」中修改）
    build:
      context: ./jimeng-web-ui
      dockerfile: Dockerfile
    image: jimeng-web-ui:latest
    container_name: jimeng-web-ui
    restart: unless-stopped
    depends_on:
      - jimeng-api
    ports:
      - "9901:80"
